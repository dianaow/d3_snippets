<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
<div id="chart"></div>
<script>

  ///////////////////////////////////////////////////////////////////////////
  ///////////////////////////////// Globals /////////////////////////////////
  /////////////////////////////////////////////////////////////////////////// 
  var data
  var canvasDim = { width: 1500, height: 1200}
  var margin = {top: 30, right: 30, bottom: 20, left: 30}
  var width = canvasDim.width - margin.left - margin.right
  var height = canvasDim.height - margin.top - margin.bottom

  var crime = ["Money Laundering", "Credit card fraud", "Sanctioned transaction", "Ponzi schemes", "Terrorist financing"]
  ///////////////////////////////////////////////////////////////////////////
  //////////////////// Set up and initiate containers ///////////////////////
  /////////////////////////////////////////////////////////////////////////// 

  var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  var nodes = svg.append('g')
    .attr('class', 'nodes')

  ///////////////////////////////////////////////////////////////////////////
  ///////////////////////////// Create scales ///////////////////////////////
  ///////////////////////////////////////////////////////////////////////////

  var colorScale = d3.scaleOrdinal()
    .domain(["1", "2", "3", "4", "5", "6", "7", "8"])
    .range(['#f0f0f0','#d9d9d9','#bdbdbd','#969696','#737373','#525252','#252525','#000000'])

  var radiusScale = d3.scaleLinear()
  .domain(d3.range(1,6))
  .range(d3.range(5, 30, 5))

  ///////////////////////////////////////////////////////////////////////////
  ////////////////////////////// Data processing ////////////////////////////
  ///////////////////////////////////////////////////////////////////////////
  for(i=0; i<5; i++) {
    run(i)
  }
  
  function run(iteration) {
    console.log('hi')
    data = d3.range(16).map(function (d,i) {
      return {
          id: i,
          parentId: crime[iteration],
          color: colorScale(getRandomArbitrary(1, 8).toString()),
          size: radiusScale(getRandomArbitrary(1, 5))
      }
    })
    data.push({id: crime[iteration], color: "white"})
    vData = d3.stratify()(data);
    drawCirclePack(vData, (iteration+1)*400);
  
  }

  ///////////////////////////////////////////////////////////////////////////
  /////////////////////////// Create circle pack ////////////////////////////
  ///////////////////////////////////////////////////////////////////////////

  function drawCirclePack(vData, w) {

      var vLayout = d3.pack().size([w, height/6]).padding(5)

      // Layout + Data
      var vRoot = d3.hierarchy(vData).sum(function (d) { return d.data.size; });
      var vNodes = vRoot.descendants();

      vLayout(vRoot);
      var vSlices = nodes.selectAll('.pack'+Math.round(w).toString()).data(vNodes)
        .enter().append('circle')
        .attr('class', 'pack'+Math.round(w).toString())

      // Draw on screen
      vSlices.attr('cx', function (d) { return d.x; })
          .attr('cy', function (d) { return d.y; })
          .attr('r', function (d) { return d.r; })
          .attr('stroke-width', '4px')
          .attr('stroke', function (d) { return d.data.data? d.data.data.color: "red" })
          .attr('fill', function (d) { return d.data.data? d.data.data.color: d.data.color })

  }

  ///////////////////////////////////////////////////////////////////////////
  ///////////////////////////// Helper functions ////////////////////////////
  ///////////////////////////////////////////////////////////////////////////

  function getRandomArbitrary(min, max) {
    return Math.round(Math.random() * (max - min) + min)
  }

</script>
</body>
</html>